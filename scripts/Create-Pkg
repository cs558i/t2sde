#!/bin/bash
#
#--- T2-COPYRIGHT-NOTE-BEGIN ---
#T2 SDE: scripts/Create-Pkg
#Copyright (C) 2004 - 2024 The T2 SDE Project
#Copyright (C) 1998 - 2003 ROCK Linux Project
#
#This Copyright note is generated by scripts/Create-CopyPatch,
#more information can be found in the files COPYING and README.
#
#This program is free software; you can redistribute it and/or modify
#it under the terms of the GNU General Public License version 2.
# --- T2-COPYRIGHT-NOTE-END ---
#

if [ $# -lt 1 ]; then
	cat <<-EOT
Usage:
$0 <option> package/repository/packagename Download_1 < Download_2, Download_n >

	EOT
	exit 1
fi

dir=
if [ $# -gt 1 ]; then
	dir=${1#package/}; shift
else
	case "$1" in
	*kde.org*)	dir=kde ;;
	*gnome.org*)	dir=gnome ;;
	*)	dir=contrib ;;
	esac

	dir="$dir/${1##*/}"
	dir="${dir%-[0-9]*}"
fi

package=${dir##*/}
if [ "$package" = "$dir" ]; then
	echo "failed"
	echo -e "\t$dir must be <rep>/<pkg>!\n"
	exit
fi

rep="$(echo package/*/$package | cut -d'/' -f 2)"
if [ "$rep" != "*" ]; then
	echo "failed"
	echo -e "\tpackage $package belongs to $rep!\n"
	exit
fi

rep=${dir/\/$package/}
confdir="package/$dir"
maintainer='The T2 Project <t2@t2-project.org>'

echo -n "Creating $confdir ... "
if [ -e $confdir ]; then
	echo "failed"
	echo -e "\t$confdir already exists!\n"
	exit
fi
if mkdir -p $confdir; then
	echo "ok"
else
	echo "failed"
	exit
fi

echo -n "Creating $package.desc ... "
	cat >$confdir/$package.desc <<EOT
[I] TODO: Short Info Title

[T] TODO: Long Text

[U] TODO: URL

[A] TODO: Author
[M] ${maintainer:-TODO: Maintainer}

[C] TODO: Category

[L] TODO: License
[S] TODO: Status
[V] TODO: Version
[P] X -----5---9 800.000

EOT

while [ "$1" ]; do
	dl=$1; shift
	file=`echo $dl | sed 's,^.*/,,g'`
	server=${dl%$file}
	echo [D] 0 $file $server >> $confdir/$package.desc
done
echo >> $confdir/$package.desc

echo "ok"
echo "Remember to fill in the TODO's:"
grep TODO $confdir/$package.*
echo

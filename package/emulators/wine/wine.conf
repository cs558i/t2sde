# --- T2-COPYRIGHT-NOTE-BEGIN ---
# T2 SDE: package/*/wine/wine.conf
# Copyright (C) 2004 - 2024 The T2 SDE Project
# Copyright (C) 1998 - 2004 ROCK Linux Project
# 
# This Copyright note is generated by scripts/Create-CopyPatch,
# more information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 2.
# --- T2-COPYRIGHT-NOTE-END ---

build_tools() {
	makeinstopt=
	mkdir -p $root$bindir/../tools
	for d in . sfnt2fon widl winebuild winegcc wmc wrc; do
		eval $MAKE $makeopt -C $d
		local f
		case $d in
		.)	f="makedep make_xftmpl wineapploader" ;;
		*)	f=$d ;;
		esac
		mkdir -p $root$bindir/../tools/$d
		for x in $f; do
			install $d/$x $root$bindir/../tools/$d/
		done
	done
}

if atstage toolchain; then
	hook_add premake 5 "cd tools"
	makeinstopt=
	hook_add inmake 5 "build_tools"
	#[[ $arch = *64 ]] &&
	var_append extraconfopt ' ' '--without-x --enable-win64'
elif atstage cross; then
	var_append extraconfopt ' ' '--with-wine-tools=$root/TOOLCHAIN/cross'
	hook_add premake 5 'ln -s $PWD $root/TOOLCHAIN/cross/usr/share/wine'
fi

if ! atstage toolchain; then
	[[ $arch = *64 ]] && var_append extraconfopt ' ' '--enable-win64'
	
	case "$arch" in
	    x86-64)	var_append extraconfopt ' ' '--enable-archs=i386,x86_64' ;;
	    arm64)	var_append extraconfopt ' ' '--enable-archs=arm,aarch64' ;;
	esac

	# wine does not find our X11R7 fontconfig :-(
	var_append CPP_WRAPPER_APPEND ' ' "`pkg-config fontconfig --cflags`"
	var_append GCC_WRAPPER_APPEND ' ' "`pkg-config fontconfig --cflags --libs-only-L`"
fi
